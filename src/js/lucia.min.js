var Lucia=function(e){"use strict";const t="l-";var n,s;!function(e){e["@"]="on",e[":"]="bind"}(n||(n={})),function(e){e[e.NULL=-1]="NULL",e[e.STATIC=0]="STATIC",e[e.DYNAMIC=1]="DYNAMIC"}(s||(s={}));const o=(e,t,n)=>{let s=`Lucia Error: "${e}"`;t&&(s+=`\n\nExpression: "${t}"`),n&&(s+="\nElement:"),console.warn(s,n)},r=(e,t,n=!0,s={})=>{const r=`${n?`return ${e}`:e}`,i=new Function(`return (${["$state","$el","$emit","$event","$refs"].join(",")})=>{with($state){${r}}}`)(),c=(e,n,s=!0)=>{const o=new CustomEvent(e,n);(s?window:t||window).dispatchEvent(o)};return(n,r)=>{try{const o=n[e];return o?"function"==typeof o?o.bind(n)():o:i(n,t,c,r,s)}catch(n){o(n,e,t)}}},i=()=>new RegExp(`(l-|${Object.keys(n).join("|")})\\w+`,"gim"),c=e=>new RegExp(`\\b${e}\\b`,"gim"),a=e=>[...new Set(e)],l=e=>e.hasAttribute("l-for"),u=(e,s={})=>{const o={},i=((e=document)=>{const t="l-ref",n=e.querySelectorAll("[l-ref]"),s={};return n.forEach((e=>{const n=e.getAttribute(t);n&&(s[n]=e)})),s})(),l=[];for(const{name:u,value:d}of e.attributes){const p="l-state"===u,f=u.startsWith(t),m=Object.keys(n).some((e=>u.startsWith(e)));if(p||!f&&!m)continue;const h=[],b=Object.keys(s);let y=!0;const g=b.filter((e=>{const t=c(e).test(String(d));if(t&&"function"==typeof s[e]){const t=b.filter((t=>c(t).test(String(s[e]))));h.push(...t)}return t}));/on|@/gim.test(u)&&(y=!1),u.includes("for")&&void 0===e.__for_template&&(e.__for_template=String(e.innerHTML).trim(),y=!1);const v=a([...g,...h]);l.push(...v);const $={compute:r(d,e,y,i),deps:v,value:d};o[(f?u.slice(t.length):`${n[u[0]]}:${u.slice(1)}`).toLowerCase()]=$}return[o,a(l)]},d=(e,t=!1,n=!1)=>{const s=[],o=l(e),r=!!(i=e).parentElement&&i.parentElement.hasAttribute("l-for");var i;if(!t&&(o||r))return s;if(n||t&&o||s.push(e),t||!o&&!r)for(const n of e.children)if(n instanceof HTMLElement)if(!t&&l(n))s.push(n);else{if(n.hasAttribute("l-state"))continue;s.push(...d(n,t,0===n.attributes.length))}return s},p=(e,t,n=!1)=>{const o=[],r=void 0!==e.component&&l(e);return d(e,r,n).forEach((e=>{if(i().test(e.outerHTML)){const n=((e,t)=>{const[n,o]=u(e,t),r=Object.keys(n).length>0,i=Object.values(n).some((({value:e})=>Object.keys(t).some((t=>c(t).test(e)))))?s.DYNAMIC:s.STATIC;return r?{el:e,deps:o,directives:n,type:i}:void 0})(e,t);n&&o.push(n)}})),o},f=e=>e.replace(/\s+/gim," ").trim(),m=(e,t,n,o)=>{const r=Object.keys(t);((e,t)=>{const n=t();return function t(){const s=performance.now();let o=null;do{o=n.next()}while(performance.now()-s<e&&!o.done);o.done||setTimeout(t)}})(25,(function*(){for(const i of e){if(i.type===s.NULL)continue;const e=i.type===s.STATIC;e&&(i.type=s.NULL),yield;if(o.some((e=>i.deps.includes(e)))||e)for(const[s,c]of Object.entries(i.directives)){const a=s.split(/:|\./gim)[0];if(!r.includes(a.toUpperCase()))continue;yield;const l=c.deps.length===i.deps.length||o.some((e=>c.deps.includes(e))),u=0===c.deps.length;if(l||e||u){const e={el:i.el,parts:s.split(/:|\./gim),data:c,node:i,state:n};y(e,t),u&&delete i.directives[s]}}}}))()},h=(e,t,n,s)=>{const o=[];e.forEach((e=>{o.push(...e.deps)}));const r=a([...t,...o]);n.deps=r,n.directives[s].deps=r},b={BIND:({el:e,parts:t,data:n,state:s})=>{switch(t[1]){case"class":{const t=n.compute(s),o=new RegExp(`\\b${Object.keys(t).join("|")}\\b`,"gim"),r=e.className.replace(o,"");if("string"==typeof t)e.className=f(`${r} ${t}`);else if(Array.isArray(t))e.className=f(`${r} ${t.join(" ")}`);else{const n=[];Object.entries(t).forEach((([e,t])=>{t&&n.push(e)})),n.length>0?e.className=f(`${r} ${n.join(" ")}`):f(r).length>0?e.className=f(r):(e.className="",e.removeAttribute("class"))}break}case"style":{const t=n.compute(s);e.hasAttribute("style")&&e.removeAttribute("style"),Object.entries(t).forEach((([t,n])=>{e.style[t]=n}));break}default:{const o=n.compute(s);"object"==typeof o&&null!==o?Object.entries(o).forEach((([t,n])=>{n?e.setAttribute(t,n):e.removeAttribute(t)})):o?e.setAttribute(t[1],o):e.hasAttribute(t[1])&&e.removeAttribute(t[1]);break}}},HTML:({el:e,data:t,state:n,node:s})=>{const o=e.component,r=t.compute(n)??t.value;if(r!==e.innerHTML&&(e.innerHTML=r,i().test(r))){const r=o??p(e,n,!0);o||h(r,t.deps,s,"html"),m(r,b,n,t.deps),e.component=r}},MODEL:({el:e,parts:t,data:n,state:s})=>{const o=e,i=s[n.value]??r(n.value,o,!0)(s),c="checkbox"===o.type?"checked":"value";if(o[c]!==String(i)&&(o[c]=i),!o.__model_registered){const e=()=>((e,t,n,s)=>{"checkbox"===e.type&&(e.value=String(e.checked));const o="number"==typeof t&&!isNaN(e.value),i="boolean"==typeof t&&("true"===e.value||"false"===e.value),c=null==t&&("null"===e.value||"undefined"===e.value);let a;return a=o?Number(e.value):i?"true"===e.value:c?"null"===e.value?null:void 0:String(e.value),s[n.value]?s[n.value]=a:(a="string"==typeof a?`decodeURI(\`${encodeURI(a)}\`)`:a,r(`(${n.value} = ${a})`,e,!0)(s)),a})(o,i,n,s);o.addEventListener("debounce"===t[1]?"change":"input",e),o.__model_registered=!0}},SHOW:({el:e,data:t,state:n})=>{const s=t.compute(n);s!==e.style.display&&(e.style.display=s?"":"none"),0===e.style.length&&e.removeAttribute("style")},ON:({el:e,parts:t,data:n,state:s})=>{const o={},r=t.slice(2),i=`__on_${t[1]}_registered`;if(e[i])return;const c=["outside","global"].some((e=>String(r).includes(e)))?window:e;o.once=r.includes("once"),o.passive=r.includes("passive"),c.addEventListener(t[1],(t=>{if(t instanceof KeyboardEvent&&/\d/gim.test(String(r))){const e=[];if(r.forEach((t=>{isNaN(t)||e.push(Number(t))})),!e.includes(t.keyCode))return}if(r.includes("prevent")&&t.preventDefault(),r.includes("stop")&&t.stopPropagation(),!r.includes("self")||t.target===e){if(r.includes("outside")){if(e.contains(t.target))return;if(e.offsetWidth<1&&e.offsetHeight<1)return}n.compute(s,t)}}),o),e[i]=!0},TEXT:({el:e,data:t,state:n})=>{const s=t.compute(n)??t.value;s!==e.textContent&&(e.textContent=s)},FOR:({el:e,data:t,state:n,node:s})=>{const o=e.component;o||(e.component=p(e,n));const[i,a]=t.value.split(/\s+(?:in|of)\s+/gim),[l,u]=i?.trim().replace(/\(|\)/gim,"").split(","),d=n[a?.trim()]??r(a?.trim(),e,!0)(n),f=e.__for_template;e.innerHTML.trim()===f&&(e.innerHTML="");const y=d?.length-e.children.length,g=/^[^\S]*?<(t(?:head|body|foot|r|d|h))/i;if(0===d?.length)e.innerHTML="";else if(0!==y){for(let t=Math.abs(y);t>0;--t)if(y<0)e.removeChild(e.lastChild);else{let n=String(f);const s=g.test(n);l&&(n=n.replace(c(`this\\.${l.trim()}`),`${a}[${d.length-t}]`)),u&&(n=n.replace(c(`this\\.${u.trim()}`),String(d.length-t))),s&&(n=`<table>${n}</table>`);const o=document.createRange().createContextualFragment(n);e.appendChild(s?o.firstElementChild.firstElementChild:o)}e.component=p(e,n)}o||(h(e.component,t.deps,s,"for"),e.removeAttribute("l-for"));const v=0===y?o:p(e,n,!0);m(v||[],b,n,s?.deps||[])}},y=(e,t)=>{t[e.parts[0].toUpperCase()](e)},g=(e,t)=>{const n=["Object","Array"].map((e=>`[object ${e}]`)),s={get(e,t){const r=e[t];if("object"==typeof r&&null!==r){const e=Object.prototype.toString.call(r);return n.includes(e)?new Proxy(r,s):(o(`Data type ${e} is not supported`),r)}return r},set(n,s,o){const r=!isNaN(Number(s))||"length"===s,i=r?[]:[s];if(Array.isArray(n)&&r){const t=Object.keys(e).filter((t=>{return Array.isArray(e[t])&&(s=e[t],o=n,Array.isArray(s)&&Array.isArray(o)&&s.length===o.length&&s.every(((e,t)=>e===o[t])));var s,o}));i.push(...t)}else if(!Object.is(n,e)){const t=Object.keys(e).filter((t=>"[object Object]"===Object.prototype.toString.call(e[t])&&JSON.stringify(e[t]).indexOf(s)>-1));i.push(...t)}return n[s]=o,t(i),!0}};return new Proxy(Object.seal(e),s)};class v{state=Object.seal({});ast=[];constructor(e){this.ast=[],this.state=e}mount(e){const t=e instanceof HTMLElement?e:document.querySelector(e)||document.body,n={...this.state,$render:this.render.bind(this)};this.ast=p(t,this.state),this.state=g(n,this.render.bind(this)),this.render(),t.component=this}render(e=Object.keys(this.state)){m(this.ast,b,this.state,e)}}const $=e=>new v(e),A=(e=document)=>{const t="l-state";[...e.querySelectorAll("[l-state]")].filter((e=>!e.component)).forEach((e=>{const n=e.getAttribute(t),s=new Function(`return ${n}`)()||{};$(s).mount(e)}))};return document.addEventListener("DOMContentLoaded",(()=>{A()})),e.component=$,e.init=A,Object.defineProperty(e,"__esModule",{value:!0}),e}({});