const u=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?e.credentials="include":t.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function r(t){if(t.ep)return;t.ep=!0;const e=i(t);fetch(t.href,e)}};u();const{init:m,component:h}=Lucia,d=document.querySelector(".wrapper"),c=document.querySelector("textarea"),s=h({html:"",code:"",raw:"",make(){this.code="",this.html="",window.history.pushState(null,"","/")},edit(){this.html="",d.dataset.raw=this.code,window.history.pushState(null,"","/")},async save(){if(this.code.trim()!="")try{const n=await fetch("/api/doc",{method:"POST",body:this.code.trim()}),{id:o}=await n.json();this.html=hljs.highlightAuto(this.code).value,window.history.pushState(null,"",`/${o}`)}catch{this.make()}}});c.addEventListener("input",()=>{d.dataset.raw=c.value});c.addEventListener("keydown",n=>{if(n.key==="Tab"){n.preventDefault();let o=document.selectionStart,i=document.selectionEnd;s.state.code=s.state.code.substring(0,o)+"	"+s.state.code.substring(i),document.selectionStart=document.selectionEnd=o+1}});async function l(){const n=window.location.pathname;if(n==="/")return s.state.make();const[,o]=n.split("/"),[i,r]=o.split(".");try{const t=await fetch(`/api/doc/${i}`,{method:"GET"}),{doc:e}=await t.json();s.state.code=e,s.state.html=(r?hljs.highlight(e,{language:r}):hljs.highlightAuto(e)).value}catch{window.history.pushState(null,"","/"),s.state.make()}}window.addEventListener("popstate",l);window.addEventListener("DOMContentLoaded",l);s.mount("#app");
